<!doctype html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="description" content="The wiki page served for bpm"><link rel="canonical" href="https://yyc12345.github.io/bpm_wiki/zh-hans/server_guide/"><meta name="author" content="yyc12345"><meta name="lang:clipboard.copy" content="Copy to clipboard"><meta name="lang:clipboard.copied" content="Copied to clipboard"><meta name="lang:search.language" content="en"><meta name="lang:search.pipeline.stopwords" content="True"><meta name="lang:search.pipeline.trimmer" content="True"><meta name="lang:search.result.none" content="No matching documents"><meta name="lang:search.result.one" content="1 matching document"><meta name="lang:search.result.other" content="# matching documents"><meta name="lang:search.tokenizer" content="[\s\-]+"><link rel="shortcut icon" href="../../img/favicon.ico"><meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.3.1"><title>服务器手册 - bpm Wiki</title><link rel="stylesheet" href="../../assets/stylesheets/application.4031d38b.css"><link rel="stylesheet" href="../../assets/stylesheets/application-palette.224b79ff.css"><meta name="theme-color" content="#009688"><script src="../../assets/javascripts/modernizr.74668098.js"></script><link rel="stylesheet" href="../../assets/fonts/material-icons.css"></head><body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal"><svg class="md-svg"><defs><svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg></defs></svg> <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off"> <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off"> <label class="md-overlay" data-md-component="overlay" for="__drawer"></label><a href="#_1" tabindex="1" class="md-skip">Skip to content </a><header class="md-header" data-md-component="header"><nav class="md-header-nav md-grid"><div class="md-flex"><div class="md-flex__cell md-flex__cell--shrink"><a href="https://yyc12345.github.io/bpm_wiki/" title="bpm Wiki" class="md-header-nav__button md-logo"><i class="md-icon">book</i></a></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label></div><div class="md-flex__cell md-flex__cell--stretch"><div class="md-flex__ellipsis md-header-nav__title" data-md-component="title"><span class="md-header-nav__topic">bpm Wiki</span><span class="md-header-nav__topic">服务器手册</span></div></div><div class="md-flex__cell md-flex__cell--shrink"></div><div class="md-flex__cell md-flex__cell--shrink"><div class="md-header-nav__source"><a href="https://github.com/yyc12345/bpm" title="Go to repository" class="md-source" data-md-source="github"><div class="md-source__icon"><svg viewBox="0 0 24 24" width="24" height="24"><use xlink:href="#__github" width="24" height="24"></use></svg></div><div class="md-source__repository">yyc12345/bpm</div></a></div></div></div></nav></header><div class="md-container"><nav class="md-tabs md-tabs--active" data-md-component="tabs"><div class="md-tabs__inner md-grid"><ul class="md-tabs__list"><li class="md-tabs__item"><a href="../.." title="bpm Wiki" class="md-tabs__link">bpm Wiki</a></li><li class="md-tabs__item"><a href="../MAIN/" title="简体中文" class="md-tabs__link md-tabs__link--active">简体中文</a></li><li class="md-tabs__item"><a href="../../en/MAIN/" title="English" class="md-tabs__link">English</a></li></ul></div></nav><main class="md-main"><div class="md-main__inner md-grid" data-md-component="container"><div class="md-sidebar md-sidebar--primary" data-md-component="navigation"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--primary" data-md-level="0"><label class="md-nav__title md-nav__title--site" for="__drawer"><a href="https://yyc12345.github.io/bpm_wiki/" title="bpm Wiki" class="md-nav__button md-logo"><i class="md-icon">book</i></a>bpm Wiki</label><div class="md-nav__source"><a href="https://github.com/yyc12345/bpm" title="Go to repository" class="md-source" data-md-source="github"><div class="md-source__icon"><svg viewBox="0 0 24 24" width="24" height="24"><use xlink:href="#__github" width="24" height="24"></use></svg></div><div class="md-source__repository">yyc12345/bpm</div></a></div><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../.." title="bpm Wiki" class="md-nav__link">bpm Wiki</a></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked><label class="md-nav__link" for="nav-2">简体中文</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-2">简体中文</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../MAIN/" title="主页" class="md-nav__link">主页</a></li><li class="md-nav__item"><a href="../user_guide/" title="用户手册" class="md-nav__link">用户手册</a></li><li class="md-nav__item md-nav__item--active"><input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc"><label class="md-nav__link md-nav__link--active" for="__toc">服务器手册</label><a href="./" title="服务器手册" class="md-nav__link md-nav__link--active">服务器手册</a><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table of contents</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#_2" title="综述" class="md-nav__link">综述</a></li><li class="md-nav__item"><a href="#_3" title="启动服务器" class="md-nav__link">启动服务器</a></li><li class="md-nav__item"><a href="#_4" title="关闭服务器" class="md-nav__link">关闭服务器</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#running" title="Running 模式" class="md-nav__link">Running 模式</a></li><li class="md-nav__item"><a href="#maintain" title="Maintain 模式" class="md-nav__link">Maintain 模式</a></li></ul></nav></li><li class="md-nav__item"><a href="#_5" title="服务器同步" class="md-nav__link">服务器同步</a></li><li class="md-nav__item"><a href="#_6" title="命令注释" class="md-nav__link">命令注释</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#_7" title="维护命令" class="md-nav__link">维护命令</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#_8" title="注意事项" class="md-nav__link">注意事项</a></li><li class="md-nav__item"><a href="#type" title="TYPE对照表" class="md-nav__link">TYPE对照表</a></li></ul></nav></li><li class="md-nav__item"><a href="#_9" title="其余命令" class="md-nav__link">其余命令</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item"><a href="../pack_guide/" title="包构建手册" class="md-nav__link">包构建手册</a></li><li class="md-nav__item"><a href="../database/" title="数据库指南" class="md-nav__link">数据库指南</a></li><li class="md-nav__item"><a href="../protocol_guide/" title="bpm网络协议手册" class="md-nav__link">bpm网络协议手册</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3"><label class="md-nav__link" for="nav-3">English</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-3">English</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../en/MAIN/" title="Home Page" class="md-nav__link">Home Page</a></li><li class="md-nav__item"><a href="../../en/user_guide/" title="User Guide" class="md-nav__link">User Guide</a></li><li class="md-nav__item"><a href="../../en/server_guide/" title="Server Operation Manual" class="md-nav__link">Server Operation Manual</a></li><li class="md-nav__item"><a href="../../en/pack_guide/" title="Building Package Manual" class="md-nav__link">Building Package Manual</a></li><li class="md-nav__item"><a href="../../en/database/" title="Database Guide" class="md-nav__link">Database Guide</a></li><li class="md-nav__item"><a href="../../en/protocol_guide/" title="bpm Network Protocol" class="md-nav__link">bpm Network Protocol</a></li></ul></nav></li></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component="toc"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table of contents</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#_2" title="综述" class="md-nav__link">综述</a></li><li class="md-nav__item"><a href="#_3" title="启动服务器" class="md-nav__link">启动服务器</a></li><li class="md-nav__item"><a href="#_4" title="关闭服务器" class="md-nav__link">关闭服务器</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#running" title="Running 模式" class="md-nav__link">Running 模式</a></li><li class="md-nav__item"><a href="#maintain" title="Maintain 模式" class="md-nav__link">Maintain 模式</a></li></ul></nav></li><li class="md-nav__item"><a href="#_5" title="服务器同步" class="md-nav__link">服务器同步</a></li><li class="md-nav__item"><a href="#_6" title="命令注释" class="md-nav__link">命令注释</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#_7" title="维护命令" class="md-nav__link">维护命令</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#_8" title="注意事项" class="md-nav__link">注意事项</a></li><li class="md-nav__item"><a href="#type" title="TYPE对照表" class="md-nav__link">TYPE对照表</a></li></ul></nav></li><li class="md-nav__item"><a href="#_9" title="其余命令" class="md-nav__link">其余命令</a></li></ul></nav></li></ul></nav></div></div></div><div class="md-content"><article class="md-content__inner md-typeset"><h1 id="_1">服务器手册</h1>
<p>本手册目的在于介绍BPMServer的使用方法。BPMServer，也就是bpm的服务器本体。</p>
<p>我已经搭建了一个bpm下载服务器并面向全球提供下载，那么为什么还要这个手册？因为我的服务器在中国大陆，对于一些地区的访问速度可能并不是那么友好，我们可能需要在全球多部署几个服务器，以达到最好的下载速度，但是这些服务器不可能都由我一个人来部署，故有此手册，介绍如何搭建一个bpm服务器。</p>
<p>此外，如果您不喜欢我的服务器，您也可以利用此手册搭建一个私有bpm服务器以为您的Ballance的圈子做专门服务。这也是这个手册存在的原因之一。</p>
<p>服务器是免费开源的，您可以在bpm的Github项目的Release页面中找到下载链接。</p>
<p>BPMServer支持在任何可以运行.Net Core的平台上运行，您需要<a href="https://dotnet.microsoft.com/download">点击这里</a>前往.Net Core下载网址，并配置好。</p>
<p>BPMServer是一个C/S应用，使用TCP流模式传输数据。因此你无需配置Web服务，只需要一个空闲端口，BPMServer就能跑起来。</p>
<p>在目前版本中，服务器本体BPMServer已和BPMSMaintenance合并，并在一起管理。（之前版本是分离的）</p>
<p>我们已删除BPMSDaemon，请使用 <code>bash</code>， <code>cmd</code> 或 <code>PowerShell</code> 相关命令来维持程序持续运行。（服务器偶尔会崩溃）</p>
<h2 id="_2">综述</h2>
<p>服务器有两种工作模式：<code>Running</code>和<code>Maintain</code>，每个模式下只能执行对应模式的指令</p>
<p><code>Running</code>标识服务器正在运行，可以接受连接请求，分发数据。<code>Maintain</code>标识服务器正在维护，在外界看来就是服务器断开了，此时可以执行添加包，删除包等操作</p>
<p>在任何情况下，服务器并不会主动给你输入命令的机会，输入命令的方式是在BPMServer中按下Tab键以打开命令输入栏，然后再输入命令执行</p>
<p>服务器开启后将自动进入<code>Running</code>模式，您可以使用<code>mode</code>指令切换模式。</p>
<h2 id="_3">启动服务器</h2>
<p>下载可执行文件后，您可以直接运行<code>dotnet BPMServer.dll</code>，服务端程序将会自动创建2个必须目录：<code>package</code> 与 <code>dependency</code>，并初始化一个空的数据库<code>package.db</code>。并自动生成一个默认配置文件 <code>config.cfg</code>，用于决定监听端口：</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;IPv4Port&quot;</span><span class="p">:</span> <span class="s2">&quot;6161&quot;</span><span class="p">,</span>
    <span class="nt">&quot;IPv6Port&quot;</span><span class="p">:</span> <span class="s2">&quot;8181&quot;</span>
<span class="p">}</span>
</pre></div>

<p>如果您不想使用这些端口，您可以在运行BPMServer之前提前配置好这个文件。或者是启动之后使用 <code>config</code>命令配置并重启BPMServer</p>
<h2 id="_4">关闭服务器</h2>
<h3 id="running">Running 模式</h3>
<p>执行<code>exit</code>命令将会立即拒绝任何新的连接请求并等待当前连接请求结束数据传输后退出程序。</p>
<p>当遇到紧急情况时，例如有人攻击了你的服务器，或者有人恶意大量获取你的数据导致服务器无法正常响应相关服务。可以执行<code>crash</code>命令来立即结束程序。此操作将会立即关闭程序，不等待任何资源的释放。</p>
<h3 id="maintain">Maintain 模式</h3>
<p>执行<code>exit</code>命令将会保存当前对数据库的修改并退出程序</p>
<p>执行<code>crash</code>命令将会**丢弃**任何对数据库的修改，**保留**任何资源文件复制的修改，然后退出程序。**强烈不建议**在<code>Maintain</code>模式下使用此命令</p>
<h2 id="_5">服务器同步</h2>
<p>同步？你在说啥？这破游戏流量那么少还需要分布式服务器？还需要同步？</p>
<p>好吧，如果流量变多的话我会搞个同步命令的。与互联网上指定计算机上的另一个 BPMServer 进行同步</p>
<h2 id="_6">命令注释</h2>
<h3 id="_7">维护命令</h3>
<ul>
<li><code>addpkg NAME AKA TYPE VERSION DESCRIPTION</code>：添加包</li>
<li><code>addver NAME VERSION</code>：添加一个新版本到当前存在的包</li>
<li><code>delpkg NAME</code>：删除包</li>
<li><code>delver NAME VERSION</code>：删除当前存在的包的一个版本</li>
</ul>
<h4 id="_8">注意事项</h4>
<ul>
<li>添加包/版本时，需要将匹配的zip文件命名为<code>new_package.zip</code>，将匹配的json文件命名为<code>new_package.json</code>，并都置于BPMSMaintenance所在目录下，然后再执行命令</li>
<li>如果参数中需要空格，例如<code>description</code>中需要输入空格，可用<code>"</code>将参数框起来，否则会判定参数个数错误</li>
<li>如果参数为空，例如<code>aka</code>不存在，输入<code>""</code>即可</li>
<li><code>delpkg</code>不会检测存在的版本个数，会悉数删除</li>
<li><code>addpkg</code>中的<code>TYPE</code>参数应输入一个数字，请按照TYPE对照表的数据输入</li>
</ul>
<h4 id="type">TYPE对照表</h4>
<table>
<thead>
<tr>
<th align="center">数值</th>
<th align="center">类型</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">0</td>
<td align="center">Mod</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">Map</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">Sky</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">Texture</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">SoundEffect</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">BGM</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">App</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">Miscellaneous</td>
</tr>
</tbody>
</table>
<h3 id="_9">其余命令</h3>
<ul>
<li><code>mode</code></li>
<li><code>mode maintain</code>：切换到<code>maintain</code>模式，将会先停止新的请求接受然后等待资源释放，最后打开数据库文件完成切换</li>
<li><code>mode running</code>：切换到<code>running</code>模式，将会先保存数据库的修改，然后打开Tcp请求接受完成切换</li>
<li><code>exit</code></li>
<li><code>exit</code>：退出程序</li>
<li><code>crash</code></li>
<li><code>crash</code>：以丢失数据的状态强行退出程序</li>
<li><code>config</code></li>
<li><code>config</code>：列出所有设置项及其值</li>
<li><code>config 设置名</code>：列出指定设置项的值</li>
<li><code>config 设置名 新值</code>：修改指定设置项的值</li>
<li><code>client</code></li>
<li><code>client</code>：列出当前连接的客户端数值</li>
</ul></article></div></div></main><footer class="md-footer"><div class="md-footer-nav"><nav class="md-footer-nav__inner md-grid"><a href="../user_guide/" title="用户手册" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev"><div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-back md-footer-nav__button"></i></div><div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class="md-flex__ellipsis"><span class="md-footer-nav__direction">Previous</span>用户手册</span></div></a><a href="../pack_guide/" title="包构建手册" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next"><div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class="md-flex__ellipsis"><span class="md-footer-nav__direction">Next</span>包构建手册</span></div><div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i></div></a></nav></div><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class="md-footer-copyright"><div class="md-footer-copyright__highlight">Text is available under the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC-BY-NC-SA 4.0</a>. Supported by <a href="https://github.com/BearKidsTeam">BearKidsTeam</a>.</div>powered by <a href="https://www.mkdocs.org">MkDocs</a> and <a href="https://squidfunk.github.io/mkdocs-material/">Material for MkDocs</a></div><div class="md-footer-social"><link rel="stylesheet" href="../../assets/fonts/font-awesome.css"> <a href="https://github.com/yyc12345/bpm_wiki" class="md-footer-social__link fa fa-github"></a>  <a href="https://discord.gg/hyarMPm" class="md-footer-social__link fa fa-discord"></a> </div></div></div></footer></div><script src="../../assets/javascripts/application.b260a35d.js"></script><script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script><script src="../../javascript/website.js"></script></body></html>