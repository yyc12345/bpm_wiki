<!doctype html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="description" content="The wiki page served for bpm"><link rel="canonical" href="https://yyc12345.github.io/bpm_wiki/zh-hans/database/"><meta name="author" content="yyc12345"><meta name="lang:clipboard.copy" content="Copy to clipboard"><meta name="lang:clipboard.copied" content="Copied to clipboard"><meta name="lang:search.language" content="en"><meta name="lang:search.pipeline.stopwords" content="True"><meta name="lang:search.pipeline.trimmer" content="True"><meta name="lang:search.result.none" content="No matching documents"><meta name="lang:search.result.one" content="1 matching document"><meta name="lang:search.result.other" content="# matching documents"><meta name="lang:search.tokenizer" content="[\s\-]+"><link rel="shortcut icon" href="../../img/favicon.ico"><meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.3.1"><title>数据库指南 - bpm Wiki</title><link rel="stylesheet" href="../../assets/stylesheets/application.4031d38b.css"><link rel="stylesheet" href="../../assets/stylesheets/application-palette.224b79ff.css"><meta name="theme-color" content="#009688"><script src="../../assets/javascripts/modernizr.74668098.js"></script><link rel="stylesheet" href="../../assets/fonts/material-icons.css"></head><body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal"><svg class="md-svg"><defs><svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg></defs></svg> <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off"> <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off"> <label class="md-overlay" data-md-component="overlay" for="__drawer"></label><a href="#_1" tabindex="1" class="md-skip">Skip to content </a><header class="md-header" data-md-component="header"><nav class="md-header-nav md-grid"><div class="md-flex"><div class="md-flex__cell md-flex__cell--shrink"><a href="https://yyc12345.github.io/bpm_wiki/" title="bpm Wiki" class="md-header-nav__button md-logo"><i class="md-icon">book</i></a></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label></div><div class="md-flex__cell md-flex__cell--stretch"><div class="md-flex__ellipsis md-header-nav__title" data-md-component="title"><span class="md-header-nav__topic">bpm Wiki</span><span class="md-header-nav__topic">数据库指南</span></div></div><div class="md-flex__cell md-flex__cell--shrink"></div><div class="md-flex__cell md-flex__cell--shrink"><div class="md-header-nav__source"><a href="https://github.com/yyc12345/bpm" title="Go to repository" class="md-source" data-md-source="github"><div class="md-source__icon"><svg viewBox="0 0 24 24" width="24" height="24"><use xlink:href="#__github" width="24" height="24"></use></svg></div><div class="md-source__repository">yyc12345/bpm</div></a></div></div></div></nav></header><div class="md-container"><nav class="md-tabs md-tabs--active" data-md-component="tabs"><div class="md-tabs__inner md-grid"><ul class="md-tabs__list"><li class="md-tabs__item"><a href="../.." title="bpm Wiki" class="md-tabs__link">bpm Wiki</a></li><li class="md-tabs__item"><a href="../MAIN/" title="简体中文" class="md-tabs__link md-tabs__link--active">简体中文</a></li><li class="md-tabs__item"><a href="../../en/MAIN/" title="English" class="md-tabs__link">English</a></li></ul></div></nav><main class="md-main"><div class="md-main__inner md-grid" data-md-component="container"><div class="md-sidebar md-sidebar--primary" data-md-component="navigation"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--primary" data-md-level="0"><label class="md-nav__title md-nav__title--site" for="__drawer"><a href="https://yyc12345.github.io/bpm_wiki/" title="bpm Wiki" class="md-nav__button md-logo"><i class="md-icon">book</i></a>bpm Wiki</label><div class="md-nav__source"><a href="https://github.com/yyc12345/bpm" title="Go to repository" class="md-source" data-md-source="github"><div class="md-source__icon"><svg viewBox="0 0 24 24" width="24" height="24"><use xlink:href="#__github" width="24" height="24"></use></svg></div><div class="md-source__repository">yyc12345/bpm</div></a></div><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../.." title="bpm Wiki" class="md-nav__link">bpm Wiki</a></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked><label class="md-nav__link" for="nav-2">简体中文</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-2">简体中文</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../MAIN/" title="主页" class="md-nav__link">主页</a></li><li class="md-nav__item"><a href="../user_guide/" title="用户手册" class="md-nav__link">用户手册</a></li><li class="md-nav__item"><a href="../server_guide/" title="服务器手册" class="md-nav__link">服务器手册</a></li><li class="md-nav__item"><a href="../pack_guide/" title="包构建手册" class="md-nav__link">包构建手册</a></li><li class="md-nav__item md-nav__item--active"><input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc"><label class="md-nav__link md-nav__link--active" for="__toc">数据库指南</label><a href="./" title="数据库指南" class="md-nav__link md-nav__link--active">数据库指南</a><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table of contents</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#packagedb" title="package.db" class="md-nav__link">package.db</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#package" title="package表" class="md-nav__link">package表</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#name" title="name" class="md-nav__link">name</a></li><li class="md-nav__item"><a href="#aka" title="aka" class="md-nav__link">aka</a></li><li class="md-nav__item"><a href="#type" title="type" class="md-nav__link">type</a></li><li class="md-nav__item"><a href="#desc" title="desc" class="md-nav__link">desc</a></li></ul></nav></li><li class="md-nav__item"><a href="#version" title="version表" class="md-nav__link">version表</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#name_1" title="name" class="md-nav__link">name</a></li><li class="md-nav__item"><a href="#parent" title="parent" class="md-nav__link">parent</a></li><li class="md-nav__item"><a href="#additional_desc" title="additional_desc" class="md-nav__link">additional_desc</a></li><li class="md-nav__item"><a href="#timestamp" title="timestamp" class="md-nav__link">timestamp</a></li><li class="md-nav__item"><a href="#suit_os" title="suit_os" class="md-nav__link">suit_os</a></li><li class="md-nav__item"><a href="#dependency" title="dependency" class="md-nav__link">dependency</a></li><li class="md-nav__item"><a href="#reverse_conflict" title="reverse_conflict" class="md-nav__link">reverse_conflict</a></li><li class="md-nav__item"><a href="#conflict" title="conflict" class="md-nav__link">conflict</a></li><li class="md-nav__item"><a href="#require_decompress" title="require_decompress" class="md-nav__link">require_decompress</a></li><li class="md-nav__item"><a href="#internal_script" title="internal_script" class="md-nav__link">internal_script</a></li><li class="md-nav__item"><a href="#hash" title="hash" class="md-nav__link">hash</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item"><a href="#installeddb" title="installed.db" class="md-nav__link">installed.db</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#installed" title="installed表" class="md-nav__link">installed表</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#name_2" title="name" class="md-nav__link">name</a></li><li class="md-nav__item"><a href="#reference_count" title="reference_count" class="md-nav__link">reference_count</a></li><li class="md-nav__item"><a href="#reference" title="reference" class="md-nav__link">reference</a></li><li class="md-nav__item"><a href="#data" title="data" class="md-nav__link">data</a></li></ul></nav></li></ul></nav></li></ul></nav></li><li class="md-nav__item"><a href="../protocol_guide/" title="bpm网络协议手册" class="md-nav__link">bpm网络协议手册</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3"><label class="md-nav__link" for="nav-3">English</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-3">English</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../en/MAIN/" title="Home Page" class="md-nav__link">Home Page</a></li><li class="md-nav__item"><a href="../../en/user_guide/" title="User Guide" class="md-nav__link">User Guide</a></li><li class="md-nav__item"><a href="../../en/server_guide/" title="Server Operation Manual" class="md-nav__link">Server Operation Manual</a></li><li class="md-nav__item"><a href="../../en/pack_guide/" title="Building Package Manual" class="md-nav__link">Building Package Manual</a></li><li class="md-nav__item"><a href="../../en/database/" title="Database Guide" class="md-nav__link">Database Guide</a></li><li class="md-nav__item"><a href="../../en/protocol_guide/" title="bpm Network Protocol" class="md-nav__link">bpm Network Protocol</a></li></ul></nav></li></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component="toc"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table of contents</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#packagedb" title="package.db" class="md-nav__link">package.db</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#package" title="package表" class="md-nav__link">package表</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#name" title="name" class="md-nav__link">name</a></li><li class="md-nav__item"><a href="#aka" title="aka" class="md-nav__link">aka</a></li><li class="md-nav__item"><a href="#type" title="type" class="md-nav__link">type</a></li><li class="md-nav__item"><a href="#desc" title="desc" class="md-nav__link">desc</a></li></ul></nav></li><li class="md-nav__item"><a href="#version" title="version表" class="md-nav__link">version表</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#name_1" title="name" class="md-nav__link">name</a></li><li class="md-nav__item"><a href="#parent" title="parent" class="md-nav__link">parent</a></li><li class="md-nav__item"><a href="#additional_desc" title="additional_desc" class="md-nav__link">additional_desc</a></li><li class="md-nav__item"><a href="#timestamp" title="timestamp" class="md-nav__link">timestamp</a></li><li class="md-nav__item"><a href="#suit_os" title="suit_os" class="md-nav__link">suit_os</a></li><li class="md-nav__item"><a href="#dependency" title="dependency" class="md-nav__link">dependency</a></li><li class="md-nav__item"><a href="#reverse_conflict" title="reverse_conflict" class="md-nav__link">reverse_conflict</a></li><li class="md-nav__item"><a href="#conflict" title="conflict" class="md-nav__link">conflict</a></li><li class="md-nav__item"><a href="#require_decompress" title="require_decompress" class="md-nav__link">require_decompress</a></li><li class="md-nav__item"><a href="#internal_script" title="internal_script" class="md-nav__link">internal_script</a></li><li class="md-nav__item"><a href="#hash" title="hash" class="md-nav__link">hash</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item"><a href="#installeddb" title="installed.db" class="md-nav__link">installed.db</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#installed" title="installed表" class="md-nav__link">installed表</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#name_2" title="name" class="md-nav__link">name</a></li><li class="md-nav__item"><a href="#reference_count" title="reference_count" class="md-nav__link">reference_count</a></li><li class="md-nav__item"><a href="#reference" title="reference" class="md-nav__link">reference</a></li><li class="md-nav__item"><a href="#data" title="data" class="md-nav__link">data</a></li></ul></nav></li></ul></nav></li></ul></nav></div></div></div><div class="md-content"><article class="md-content__inner md-typeset"><h1 id="_1">数据库指南</h1>
<p>本篇目介绍bpm中使用的各类数据库以及其内部字段的含义。</p>
<p>bpm使用SQLite作为数据库驱动程序。bpm的数据库分为两部分，一个是<code>package.db</code>，此数据库会被服务器进行分发，其记录了各个包的相关数据，另一个则是只存在于客户端本地的<code>installed.db</code>，其记录了本地安装的包的依赖关系及存储的包的设置。</p>
<h2 id="packagedb">package.db</h2>
<p><code>package.db</code>包含了两个表，<code>package</code>表记录了存在的包，而<code>version</code>表记录了所有的包的所有版本的详细信息。</p>
<h3 id="package">package表</h3>
<div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">package</span> <span class="p">(</span>
    <span class="n">name</span>   <span class="nb">TEXT</span>    <span class="k">NOT</span> <span class="k">NULL</span>
                   <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span>
                   <span class="k">CONSTRAINT</span> <span class="n">PK_package</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">aka</span>    <span class="nb">TEXT</span>    <span class="k">NOT</span> <span class="k">NULL</span>
                   <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="k">type</span>   <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span>
                   <span class="k">DEFAULT</span> <span class="mi">7</span><span class="p">,</span>
    <span class="p">[</span><span class="k">desc</span><span class="p">]</span> <span class="nb">TEXT</span>    <span class="k">NOT</span> <span class="k">NULL</span>
                   <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span>
<span class="p">);</span>
</pre></div>

<h4 id="name">name</h4>
<p>包名，主键（唯一性），只是包的名称，无需带上版本号，版本是由<code>version</code>表来描述的</p>
<h4 id="aka">aka</h4>
<p>指示包的别名，此字段用于I18N，即此字段可以是多种语言组合而成的，例如自杀器插件，其包名是<code>ball-killer</code>，然后<code>aka</code>字段可以输入为<code>自杀器</code>，这样以来用户就可以很轻松地根据自己所使用的语言搜索到想要的包。多个aka之间使用<code>,</code>分割。bpm在执行搜索时会同时搜索<code>name</code>和<code>aka</code>字段</p>
<h4 id="type">type</h4>
<p>包的类型，分为以下几种类型：</p>
<ul>
<li>Mod：用于游戏的插件</li>
<li>Map：游戏地图</li>
<li>Sky：游戏天空盒子背景</li>
<li>Texture：游戏材质（除天空部分）</li>
<li>SoundEffect：游戏音效（除BGM部分）</li>
<li>BGM：游戏背景音乐</li>
<li>App：与游戏有关的一些附属程序</li>
<li>Miscellaneous：不属于以上任意一个</li>
</ul>
<p>在程序内部是一个<code>enum</code>，在数据库中转换为<code>INTEGER</code>进行存储。详细数据含义可参考<code>ShareLib/Package.cs</code>文件</p>
<h4 id="desc">desc</h4>
<p>有关此包的描述，通常是这个包的功能的描述，此部分内容无需I18N，纯英文即可。可以为空字符串（不是<code>NULL</code>）</p>
<h3 id="version">version表</h3>
<div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">version</span> <span class="p">(</span>
    <span class="n">name</span>               <span class="nb">TEXT</span>    <span class="k">NOT</span> <span class="k">NULL</span>
                               <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span>
                               <span class="k">CONSTRAINT</span> <span class="n">PK_version</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">parent</span>             <span class="nb">TEXT</span>    <span class="k">NOT</span> <span class="k">NULL</span>
                               <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">additional_desc</span>    <span class="nb">TEXT</span>    <span class="k">NOT</span> <span class="k">NULL</span>
                               <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="k">timestamp</span>          <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span>
                               <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">suit_os</span>            <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span>
                               <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">dependency</span>         <span class="nb">TEXT</span>    <span class="k">NOT</span> <span class="k">NULL</span>
                               <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">reverse_conflict</span>   <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span>
                               <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">[</span><span class="n">conflict</span><span class="p">]</span>         <span class="nb">TEXT</span>    <span class="k">NOT</span> <span class="k">NULL</span>
                               <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">require_decompress</span> <span class="nb">TEXT</span>    <span class="k">NOT</span> <span class="k">NULL</span>
                               <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">internal_script</span>    <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span>
                               <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">hash</span>               <span class="nb">TEXT</span>    <span class="k">NOT</span> <span class="k">NULL</span>
                               <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span>
<span class="p">);</span>
</pre></div>

<h4 id="name_1">name</h4>
<p>包的 <strong>全名</strong>，即符合<code>包名@版本</code>格式的字符串。</p>
<h4 id="parent">parent</h4>
<p>指示当前包是哪个包的一个版本，即<code>包名@版本</code>格式中的<code>包名</code>部分，此字段的值必须存在于<code>pakcage</code>表中的<code>name</code>字段</p>
<h4 id="additional_desc">additional_desc</h4>
<p>对于当前包的补充说明，即对于<code>package</code>表中<code>desc</code>字段未说明的内容或者是对于当前版本的特有内容的一个补充说明。可以为空字符串（不是<code>NULL</code>）</p>
<h4 id="timestamp">timestamp</h4>
<p>一个UNIX时间戳，不包含毫秒，长度为Int64，用于指示当前包的添加时间（在bpm内部被用于判断包的新旧）</p>
<h4 id="suit_os">suit_os</h4>
<p>表示适用的操作系统，通常用于App类型的包用于判断当前包是否可以被安在此操作系统上。此数值使用<code>[Flags]</code>标识的<code>enum</code>构成，详细构成请查询<code>ShareLib/Package.cs</code>。</p>
<h4 id="dependency">dependency</h4>
<p>表示此包需要的依赖，即，没有此列表中的包，此包无法正常运行。可以填写为一个包名，例如：<code>999_sections_loader</code>，则表明此包可以以指定包的任何版本为依赖。也可以指定为<code>包@版本</code>格式，例如：<code>999_sections_loader@v_gamepiaynmo</code>，则表明此包只能以指定包的指定版本为依赖。</p>
<p>依赖可以有多个，多个依赖之间使用<code>,</code>分割即可</p>
<h4 id="reverse_conflict">reverse_conflict</h4>
<p>一个Bool值，用于指示conflict的含义。如果为false，则表示conflict中存储的是与此包不兼容，有冲突的包。如果指定true，则表示反转conflict的含义，即此包只与conflict中所书写的包兼容。如果指定true，默认是兼容自己（此包的此版本）的，如果此时conflict中未填写任何包的话，则表明此包与所有包（除自己）都不兼容。</p>
<h4 id="conflict">conflict</h4>
<p>原意为表示与此包冲突的包，同理，可以填写为包名或<code>包@版本</code>格式。其具体含义由<code>reverseConflict</code>指示。同样，其可以有多个，多个包之间使用<code>,</code>分割即可</p>
<h4 id="require_decompress">require_decompress</h4>
<p>表示是否需要解压缩，即当前包是否是单文件包，单文件包是无需解压的。</p>
<p>对于压缩包，此字段填空字符串（不是<code>NULL</code>）。对于非压缩包，此字段指示该文件下载后应该被命名为何种名称，例如对于一个地图，你可以填入<code>MapNameInPackage.nmo</code>，这样它就会被自动命名为<code>MapNameInPackage.nmo</code>（这个名称是内置脚本<code>Map</code>所需要使用的名称）；对于那种只有单个脚本的包，可以填入<code>Setup.cs</code>，它就会被自动命名为<code>Setup.cs</code>，这样bpm就可以在后续过程中识别到这个脚本。</p>
<h4 id="internal_script">internal_script</h4>
<p>表示是否需要使用内置脚本。此字段是一个<code>bool</code>类型字段，但是在数据库中被表现为<code>INTEGER</code>类型</p>
<p>无需使用内置脚本时，此字段填<code>false</code>（数据库中转换为<code>0</code>），否则填写<code>true</code>（数据库中转换为<code>1</code>）。</p>
<p>内置脚本的执行类型根据此包在<code>package</code>表中的<code>type</code>字段来决定，同时，仅支持<code>Map</code>，<code>Sky</code>，<code>Texture</code>，<code>SoundEffect</code>，<code>BGM</code>类型的内部脚本，其余类型的均会报找不到脚本文件的错误。</p>
<h4 id="hash">hash</h4>
<p>表示当前包文件的摘要，使用<code>SHA256</code>进行摘要并使用Base64进行格式化后再存储到此字段</p>
<h2 id="installeddb">installed.db</h2>
<p><code>package.db</code>只有一个表：<code>installed</code></p>
<h3 id="installed">installed表</h3>
<div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">installed</span> <span class="p">(</span>
    <span class="n">name</span>            <span class="nb">TEXT</span>    <span class="k">NOT</span> <span class="k">NULL</span>
                            <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span>
                            <span class="k">CONSTRAINT</span> <span class="n">PK_installed</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">reference_count</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span>
                            <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">reference</span>       <span class="nb">TEXT</span>    <span class="k">NOT</span> <span class="k">NULL</span>
                            <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="k">data</span>            <span class="nb">TEXT</span>    <span class="k">NOT</span> <span class="k">NULL</span>
                            <span class="k">DEFAULT</span> <span class="s1">&#39;{}&#39;</span>
<span class="p">);</span>
</pre></div>

<h4 id="name_2">name</h4>
<p>包的 <strong>全名</strong>，即符合<code>包名@版本</code>格式的字符串。此包必须是已经安装在此计算机上的包</p>
<h4 id="reference_count">reference_count</h4>
<p>对于此包的引用计数，当此数值为<code>0</code>时，表示无任何包依赖此包，可安全删除</p>
<h4 id="reference">reference</h4>
<p>引用列表，其是一个数组，各个元素之间由<code>,</code>分割，元素是符合<code>包名@版本</code>格式的字符串。表示的含义即为数组内的元素依赖此包。数组元素的格式与<code>reference_count</code>相等。</p>
<h4 id="data">data</h4>
<p>当前包存储的设置类数据。此数据是在执行包脚本的时候产生的。此字段是一个JSON字符串，在程序内部转换为字典提供给脚本使用。</p></article></div></div></main><footer class="md-footer"><div class="md-footer-nav"><nav class="md-footer-nav__inner md-grid"><a href="../pack_guide/" title="包构建手册" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev"><div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-back md-footer-nav__button"></i></div><div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class="md-flex__ellipsis"><span class="md-footer-nav__direction">Previous</span>包构建手册</span></div></a><a href="../protocol_guide/" title="bpm网络协议手册" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next"><div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class="md-flex__ellipsis"><span class="md-footer-nav__direction">Next</span>bpm网络协议手册</span></div><div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i></div></a></nav></div><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class="md-footer-copyright"><div class="md-footer-copyright__highlight">Text is available under the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC-BY-NC-SA 4.0</a>. Supported by <a href="https://github.com/BearKidsTeam">BearKidsTeam</a>.</div>powered by <a href="https://www.mkdocs.org">MkDocs</a> and <a href="https://squidfunk.github.io/mkdocs-material/">Material for MkDocs</a></div><div class="md-footer-social"><link rel="stylesheet" href="../../assets/fonts/font-awesome.css"> <a href="https://github.com/yyc12345/bpm_wiki" class="md-footer-social__link fa fa-github"></a>  <a href="https://discord.gg/hyarMPm" class="md-footer-social__link fa fa-discord"></a> </div></div></div></footer></div><script src="../../assets/javascripts/application.b260a35d.js"></script><script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script><script src="../../javascript/website.js"></script></body></html>