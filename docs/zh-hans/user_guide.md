# 用户手册

此手册旨在指导一位刚刚接触bpm的新人如何正确使用bpm。然而bpm是个命令行程序，很明显，它根本不是为计算机小白准备的，请确认您的计算机认知，然后再考虑阅读此手册。

我会用我能说出的最直白的语言告诉你如何操作，如果您仍然无法理解操作过程，您可以向其他已经知道如何使用bpm的人进行更详细的咨询。

## 配置与安装

bpm与大多数软件一样，需要进行安装，您可以在bpm的Github开源页面中的Release板块找到最新的编译版本并下载。下载务必完全解压到一个空白文件夹中，然后我们就得到了bpm本体，但是此时bpm是无法运行的，此时需要根据您的计算机的操作系统类型进行选择。对于大多数用户来说，请阅读下面的Windows章节。

### Windows

**如果你只会通过双击程序来启动程序，并且拒绝学习任何新方法用于启动程序，建议立即关闭这个文档并删除所有bpm内容。**

#### 配置安装环境

先来安装安装环境，[点击这里](https://dotnet.microsoft.com/download)前往.Net Core下载网址，并下载对应的 Windows 安装包（下载 Runtime 即可）

#### 验证安装正确

使用搜索功能（Windows 7在开始菜单下方，Windows 10请使用Cortana）搜索`Cmd`，找到后右键-以管理员身份运行。

然后前往你放有bpm的文件夹，复制这个文件夹的地址，它看起来可能比较像`D:\MySoftware\bpm`，我们把这堆文本记为`xxx`。

然后在你刚刚打开的 Cmd 窗口中输入指令`cd /d xxx`，其中`xxx`是你刚刚复制的文件夹地址，然后回车

然后输入`bpm help`并回车，如果能输出一串帮助文档，则表明没有问题了。如果没有输出，请再次检查您的设置是否正确，如果仍然一头雾水，可以尝试咨询其他人。

#### 全局配置

上面执行bpm的方法似乎有些麻烦，因为步骤太过烦琐了，我想直接敲bpm命令就能执行怎么办？我们可以将bpm配置为全局命令。

右键此电脑（Windows 10是此电脑，Windows 7是计算机），选择属性，在打开的窗口的左侧选择高级系统设置，点击高级选项卡中的环境变量。

在用户变量中选中`PATH`（如果不存在请创建一个），还记得之前我们记住的`xxx`吗？把它添加进去（Windows 10的添加较为直观，Windows 7的添加请注意不要忘记各个路径之间用以区分的分号）

此后，我们在任意地方开启Cmd，都可以直接执行bpm了。（必须要开Cmd否则你拿什么来显示内容呢？）

### Linux

我们默认使用 Linux 的您掌握了一切基础的计算机知识。

#### 配置安装环境

请先前往[.Net Core 下载网址](https://dotnet.microsoft.com/download)查阅如何配置.Net Core环境

#### 验证安装正确

在bpm所在文件夹打开终端模拟器

您可以输入`bpm.sh help`并回车来验证环境的配置正确。

#### 全局配置

至于如何让 bpm 成为一个全局命令，我相信您一定会操作（我才不会说是我懒了）

#### 使用须知

`bpm.sh`这个脚本我实际上并没有在任何Linux系统上跑过，里面可能会有一些问题（例如执行目录的问题），碍于我的能力限制，我暂时无法在短时间内修复它，如果您可以分享您的启动脚本，请不要吝啬PullRequest

### macOS

自己动手，丰衣足食。待完善。

## 命令输入

bpm采用的是参数输入的方式来工作的，也就是说程序运行一次只能执行一次命令，有多少个命令就会启动程序多少次。

命令的格式大致为`bpm 命令名 参数1 参数2 ...`，请在终端或者Cmd中直接输入即可。对于输入参数的UTF-8支持暂时未知，至少我在Windows 10下用PowerShell的时候是完全OK的。

## 命令详解

??? abstract "list"
    - `list`：列出当前安装的包信息

??? abstract "update"
    - `update`：与远程服务器同步包数据库

??? abstract "show"
    - `show 包名`：输出指定包的详细信息，包名需要指定版本号

??? abstract "search"
    - `search 单词1 单词2 ...`：从数据库中搜索与所提供单词有关的包，会搜索包名与包别名。可指定多个搜索单词，单词数量不受限制

??? abstract "install"
    - `install 包名`：安装指定包，包名可以不指定版本号（默认安装最高版本）

??? abstract "remove"
    - `remove 包名`：移除指定包，包名可以不指定版本号（默认删除全部版本）

??? abstract "guide"
    - `guide 包名`：展示指定包的帮助，大多都是帮助您确认deploy参数，包名需要指定版本号

??? abstract "deploy"
    - `deploy 包名 参数`：配置包，用于地图，背景等各类资源包的配置，包名需要指定版本号

??? abstract "clean"
    - `clean`：删除所有缓存文件（下载zip以及依赖json）
    - `clean 包名`：删除指定包的缓存文件，包名可以不指定版本号（默认删除全部版本）

??? abstract "config"
    - `config`：列出所有设置项及其值
    - `config 设置名`：列出指定设置项的值
    - `config 设置名 新值`：修改指定设置项的值

## 注意事项

* 第一次启动bpm会自动建立一系列文件夹，在任何时候都请勿删除这些文件夹
* 执行`bpm update`之后会在本地得到一个`package.db`，请在任何时候都不要删除这个文件
* 在安装任意一个包之后，会在本地得到一个`InstallRecord.db`，也请在任何时候都不要删除这个文件
* bpm不会自动识别您已安装的 Ballance。相反，我们反而建议您在一台没有安装 Ballance 的计算机上先安装 bpm，或者是卸载现在安装过的 Ballance 转而安装 bpm，然后由 bpm 安装 Ballance，这样可使 bpm 得以管理一切。您需要使用`bpm config GamePath xxx`先指定你想安装Ballance的文件夹，bpm 会将所有游戏文件存储在那。如果您坚持使用您自己安装的 Ballance，也是可以的，您只需要使用`bpm config GamePath xxx`将游戏地址设置为您的Ballance根目录即可，但请务必确保您的Ballance是英文原版，没有任何修改，否则任何命令执行时的错误，我都不会给予帮助支持。使用bpm安装 Ballance 的命令是`bpm install ballance@v1.13`
* 针对上面一条，由于bpm现在处于公开测试阶段，暂时不提供Ballance本体下载操作，故请您务必安装一个完全原版的Ballance然后再使用`bpm config GamePath xxx`设置游戏地址
* 默认语言为英语，使用`bpm config Language zh-cn`设置中文
* 默认连接到 Ballance 资源总服务器，如果需要连接其它服务器，使用`bpm config Sources IP:Port`进行设置
* 第一次启动后，需要执行`bpm update`更新包数据库后才能执行大部分操作
* Windows下执行bpm命令，最好以管理员运行，尤其是你的游戏安装在系统盘符下的时候。因为bpm需要对游戏进行操作；如果是在安装游戏时，还需要操作注册表以注册Ballance。不足的权限会导致一些不必要的，难以解释的错误。如果未按此操作进行，造成的后果不会提供任何技术支持。
* Linux下*应该*不需要使用`root`权限执行，不过在安装Ballance的时候，在wine中注册注册表的时候不清楚是否需要权限。
